<!doctype html>
<html lang="en">

  <head>
    <meta charset="utf-8">

    <title>Jenkins by DevOps</title>

    <meta name="description" content="CONFIGURATION MANAGMENT WORKSHOP, Jenkins by DevOps">
    <meta name="author" content="Karol Lassak">

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

    <link rel="stylesheet" href="css/reveal.css">
    <link rel="stylesheet" href="css/theme/black.css" id="theme">
    <link rel="stylesheet" href="css/custom.css">

    <!-- Code syntax highlighting -->
    <link rel="stylesheet" href="lib/css/zenburn.css">

    <!-- Printing and PDF exports -->
    <script>
      var link = document.createElement( 'link' );
      link.rel = 'stylesheet';
      link.type = 'text/css';
      link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
      document.getElementsByTagName( 'head' )[0].appendChild( link );
    </script>

    <!--[if lt IE 9]>
    <script src="lib/js/html5shiv.js"></script>
    <![endif]-->
  </head>

  <body>
    <div class="reveal">
      <div class="slides">

        <!-- SLIDES STARTS HERE -->

        <section>

        <h1>Jenkins by DevOps</h1>
        <h4>with <span class="blue">Puppet</span></h4>
        <p><span style="font-size:16px">by Karol Lassak | <a href="https://twitter.com/IngwarSwenson" target="_blank">@IngwarSwenson</a></span></p>

      </section>

      <section data-background-color="#4c1130">
        <section>
          <img style="float: right; margin: 20" height="250" src="img/ingwar.jpg">
          <div style="text-align: left;">
            <h1 class="blue">Heya!</h1>
            <p>Karol Lassak</p>
            <ul>
              <li class="fragment">Technical Lead/DevOps</li>
              <li class="fragment">Aktualnie Programista w Allegro
                  <div style="background: white; padding: 30px 20px 20px 40px; margin-top: 20px;" widt="203px">
                    <img  src="img/pres/logo-allegro-tech.svg" />
                  </div>
              </li>
            </ul>
          </div>
        </section>

            <section>
              <ul>
                <li>Programista od 10 lat</li>
                <li>Od początku projekty z administratorami i dla nich</li>
                <li class="fragment">Duże wdrożenia z DevOps / Puppet</li>

                <span class="fragment" style="display: inline-block; background: white; padding: 1em;">
                  <img height="100" src="img/logos/puppet.png"/>
                  <img height="100" src="img/pres/jboss.png"/>
                  <img height="100" src="img/pres/ruby-logo.png"/>
                  <img height="100" src="img/pres/java-logo.png"/>
                  <img height="100" src="img/logos/vagrant.png"/>
                  <img height="100" src="img/logos/docker.png"/>
                </span>

              </ul>
            </section>
      </section>

      <section>
        <section>
          <h2>Jak będzie wyglądał warsztat?</h2>

            <ul>
                <li class="fragment">Krótki wstęp teoretyczny</li>
                <li class="fragment">Samodzielna praca</li>
                <li class="fragment">Przerwa koło 13</li>
                <li class="fragment">Mikro projekt</li>
            </ul>

        </section>

        <section>
          <h2>Co przed nami?</h2>
          <ol>
            <li class="fragment">Co to jest Jenkins i gdzie w tym Puppet?</li>
            <li class="fragment">Puppet przypomnienie podstaw
              <ul>
              <li>Składnia deklaratywnych manifestów</li>
              <li>Zasoby i zarządzanie kolejnością</li>
              <li>Klasy i definicje</li>
              </ul>
            </li>
            <li class="fragment">Moduły Puppet</li>
              <li class="fragment">Puppet Forge</li>
            <li class="fragment">Tworzenie modulu Jenkins</li>
          </ol>
        </section>

          <section data-background-color="#A61C00">
              <h1>Zadanie</h1>
              <p>Przygotować maszyne virtualną do ćwiczeń</p>
              <ul>
                  <li>Vagrant</li>
                  <li>VirtualBox</li>
                  <li>Box<pre>vagrant box add puppetlabs/ubuntu-14.04-64-nocm</pre></li>
              </ul>

          </section>

          <section data-background-color="#5A983F">
              <h1>Dyskusja</h1>
              <ul>
                  <li>Jakie cele mam na tym warsztacie?</li>
                  <li>Czy potrafię wskazać na czym najbardziej mi zależy?</li>
                  <li>Czy mam już plan jak wykorzystać zdobytą tu wiedzę?</li>
              </ul>
          </section>

      </section>

      <section>
        <section>
          <h1>Jenkins</h1>
            <img height="500" src="img/logos/jenkins.png"/>
        </section>

        <section>
            <h2>Jenkins</h2>
            <ul>
                <li>Jedno z najpopularniejszych, darmowych narzedzi <span class="blue">continuous integration</span></li>
                <li class="fragment">Przy jego pomocy mozna zbudowac łatwo process <span class="blue">continuous deployment</span></li>
                <li class="fragment">Łatwa instalacja: pakiety do wiekszosci dystrybucji lub <span class="blue">java -jar jenkins.war</span></li>
                <li class="fragment">Łatwa konfiguracja poprzez web GUI</li>
                <li class="fragment">Bardzo duża ilość <a href="https://wiki.jenkins-ci.org/display/JENKINS/Plugins">pluginów</a></li>
            </ul>
        </section>
          <section>
              <h2>Jenkins + Puppet</h2>
              <h4>Dlaczego tak?</h4>
              <ul>
                  <li class="fragment">Dostajemy konfiguracje zapisaną w <span class="blue">kodzie</span></li>
                  <li class="fragment">Przy dużej iloci zadań zarzadzanie nimi poprzez GUI jest bardzo czasochłonne</li>
                  <li class="fragment">Znika problem <span class="blue">state of art</span>, łatwo można odtworzyć środowisko</li>
                  <li class="fragment">Pozbywamy się również problemu <span class="blue">pływającej konfiguracji</span></li>
              </ul>
          </section>

          <section data-background-color="#5A983F">
              <h1>Demonstracja Jenkins</h1>
          </section>
      </section>

      <section>

        <section>
          <img src="img/logos/puppet.png" />
          <p class="fragment">Jedno z najbardziej dojrzałych narzędzi DevOps</p>
        </section>

        <section>
          <h1>Czytelność Puppet</h1>
          <pre><code>package { 'postgresql':
  ensure => 'installed',
}

service { 'postgresql':
  ensure  => 'running',
  enable  => true,
  require => Package['postgresql'],
}</code></pre>
          <p class="fragment">Co to znaczy? Na pierwszy rzut oka?</p>
        </section>

        <section>
          <h2 class="blue">Zalety Puppet</h2>
          <p>Dostarcza możliwości zapisania oczekiwanego stanu infrastruktury IT</p>
          <p class="fragment">Wymuszenia wykonania zmian dostosowującego ją do tegoż stanu</p>
          <p class="fragment">Wszystkie elementy składowe to open-source</p>
          <p class="fragment">Prosty język manifestów naturalnie przyjazny administratorom</p>
          <p class="fragment">Silnik Puppeta składa się z zestawu komend konsoli systemu, które również można efektywnie wykorzystywać w oderwaniu od Puppeta</p>
        </section>

        <section>
          <h2 class="blue">Zalety Puppet - c.d.</h2>
          <p>Język DSL w postaci deklaratywnej tzn. 4 generacji podobnie jak SQL</p>
          <p class="fragment">Brak podejścia &quot;all or nothing&quot;, można go wprowadzać na dowolnym etapie zaawansowania projektu</p>
          <p class="fragment">Największa społeczność użytkowników</p>
          <p class="fragment">Możliwość prostego rozszerzenia silnika Puppeta w postaci zarówno manifestów Puppet jak i kodu niskopoziomowego Ruby</p>
          <p class="fragment">Wytwarza naturalny podział pracy: programiści piszą kod w Ruby a administratorzy używają prostszych manifestów</p>
        </section>

        <section>
          <h2 class="blue">Zalety Puppet - c.d. 2</h2>
          <p>Największa ilość gotowych do użycia modułów i rozszerzeń</p>
          <p class="fragment">Moduły pisane i utrzymywane przez firmę Puppetlabs</p>
          <p class="fragment">Dogłębne testowanie jednostkowe, &quot;dymne&quot;, integracyjne i akceptacyjne</p>
          <p class="fragment">Możliwość symulowania zmiany w systemie</p>
          <p class="fragment">Dokładne, szczegółowe raportowanie</p>
          <p class="fragment">Bezpieczna i skalowalna architektura agent --&gt; serwer</p>
        </section>

        <section>
          <h2 class="blue">Zalety Puppet - c.d. 3</h2>
          <p>Wsparcie i integracje z innymi narzędziami np. Vagrant, VMWare, OpenStack</p>
          <p class="fragment">Wsparcie enterprise firmy Puppetlabs i Red Hat, oraz dodatkowe bardzo przydatne narzędzia takie jak Enterprise Console, Razer czy Cloud Provisioning</p>
          <p class="fragment">Wsparcie dla największej liczby systemów operacyjnych: Linux (RHEL i podobne, Debian i podobne), Suse, AIX, Solaris, Windows, Mac OSX</p>
          <p class="fragment">Największe wsparcie dla edytorów kodu, systemów weryfikacji i budowania oraz integracji ciągłej</p>
        </section>
      </section>

      <section>
        <section>
          <h1 class="blue">Puppet</h1>
          <h2>Jak działa?</h2>
        </section>

        <section>
          <h1>Proces działania</h1>
          <img src="img/PL_howpuppetworks_notitle.png" style="background-color: white; padding:1em;">
        </section>

        <section>
          <h1>Klasyfikacja</h1>
          <img src="img/PL_multiode_notitle1.png" style="background-color: #fff; padding:1em">
        </section>

        <section>
          <h2>Proces wprowadzania zmiany</h2>
          <img src="img/PL_dataflow_notitle.png" style="background-color: #fff; padding:1em">
        </section>

      </section>

          <section data-background="#A61C00">
              <h1>Zadanie 1</h1>
              <p>Uruchomienie Vagranta z Puppetem</p>
          </section>

      <section>
        <section data-background-color="#1C4587">
          <h1>Opis ekosystemu Puppet</h1>
          <p>Puppet składa się z kilku luźno powiązanych ze sobą narzędzi i systemów.</p>
          <p class="fragment">Dzięki temu daje możliwość używania ich niezależnie</p>
        </section>

        <section>
          <h1>Facter</h1>
          <p>Narzędzie działające między innymi w konsoli systemowej. Jego zadaniem jest wyliczanie faktów na temat maszyny na której został uruchomiony.</p>
        </section>

        <section>
          <h2>Facter - przykład</h2>
          <pre><code class="ini">$ facter
architecture => amd64
ipaddress => 172.17.42.1
kernel => Linux
kernelmajversion => 3.11
kernelrelease => 3.11.0-26-generic
kernelversion => 3.11.0
lsbdistcodename => saucy
lsbdistdescription => Ubuntu 13.10
lsbdistid => Ubuntu
lsbdistrelease => 13.10
lsbmajdistrelease => 13.10
operatingsystem => Ubuntu
operatingsystemmajrelease => 13.10
operatingsystemrelease => 13.10
osfamily => Debian
puppetversion => 3.2.4
rubyplatform => x86_64-linux
rubyversion => 1.9.3
timezone => CET
uniqueid => 007f0100
uptime => 1 day
uptime_days => 1
uptime_hours => 45
uptime_seconds => 165504
virtual => physical
$ _
          </code></pre>
        </section>

        <section data-background="#A61C00">
          <h1>Zadanie 6</h1>
          <ul>
            <li>Uruchom polecenie: <code>facter ipaddress</code></li>
            <li>Uruchom polecenie: <code>facter fqdn</code></li>
            <li>Uruchom polecenie: <code>facter operatingsystem</code></li>
            <li>Uruchom polecenie: <code>facter</code></li>
            <li>Co zwracają te polecenia? Jak można to wykorzystać?</li>
          </ul>
        </section>

        <section>
          <h1>Augeas</h1>
          <p>Narzędzie elastycznego zmieniania konfiguracji plików. Potrafi inteligentnie zmieniać treść bardzo wielu różnych formatów plików, selektywnie, zmieniając jedyne pożądaną wartość i nie zmieniając nic w przypadku pełnej zgodności.</p>
        </section>

        <section>
          <h2>Augeas</h2>
          <pre><code class="ini" style="font-size: 17px;">$ augtool
augtool> get /files/etc/postgresql/9.1/main/postgresql.conf/max_connections
/files/etc/postgresql/9.1/main/postgresql.conf/max_connections = 100
augtool> set /files/etc/postgresql/9.1/main/postgresql.conf/max_connections 130
augtool> get /files/etc/postgresql/9.1/main/postgresql.conf/max_connections
/files/etc/postgresql/9.1/main/postgresql.conf/max_connections = 130
augtool> save</code></pre>
        </section>

        <section>
          <h1 class="blue">Demo</h1>
          <h2>Augeas</h2>
        </section>

        <section>
          <h1>Hiera</h1>
          <p>Hierarchiczna, prosta baza danych dzięki której możliwe są kontekstowe konfiguracje.</p>
        </section>

        <section>
          <h2>Hiera - graf</h2>
          <pre style="font-size: 18px;"><code>

     /------------- DC1 -------------\    /------------- DC2 -------------\
    | ntpserver: ntp1.dc1.example.com |  | ntpserver: ntp1.dc2.example.com |
    | sysadmin: dc1noc@example.com    |  |                                 |
    | classes: users::dc1             |  | classes: users::dc2             |
     \-------------------------------/    \-------------------------------/
                              \             /
                                \         /
                         /------------- COMMON -------------\
                        | ntpserver: 1.pool.ntp.org          |
                        | sysadmin: sysadmin@%{domain}       |
                        | classes: users::common             |
                         \----------------------------------/
          </code></pre>
        </section>

        <section>
          <h1 class="blue">Demo</h1>
          <h2>Hiera</h2>
        </section>

        <section>
          <h1 class="blue">puppet resource</h1>
          <p>Możliwość uruchamiania puppeta dla konkretnych pojedynczych zasobów i listowania ich</p>
        </section>

        <section>
          <h2>puppet resource - przykład</h2>
          <pre><code class="puppet"># puppet resource user ksuszynski
user { 'ksuszynski':
  ensure  => 'present',
  comment => 'Krzysztof Suszynski,,,',
  gid     => '1000',
  groups  => ['adm', 'sudo', 'docker'],
  home    => '/home/ksuszynski',
  shell   => '/bin/bash',
  uid     => '1000',
}</code></pre>
        </section>

        <section>
          <h1 class="blue">Demo</h1>
          <h2>puppet resource</h2>
        </section>

        <section data-background="#A61C00">
          <h1>Zadanie 7</h1>
          <ul>
            <li>Utwórz użytkownika: <code>useradd -s /bin/bash -b /home twoje-imie</code></li>
            <li>Uruchom polecenie: <code>puppet resource user twoje-imie</code></li>
            <li>Ustaw hasło: <code>passwd twoje-imie</code></li>
            <li>Sprawdź, uruchamiając polecenie: <code>puppet resource user twoje-imie</code></li>
            <li>Zmień shell przy użyciu: <code>puppet resource user twoje-imie shell=/bin/sh</code></li>
            <li>Wykonaj i sprawdź wynik: <code>puppet resource user</code></li>
            <li>Co zwracają te polecenia? Jak można to wykorzystać?</li>
          </ul>
        </section>
      </section>

      <section>
        <section data-background-color="#1C4587">
          <h1>Podstawa składni DSL Puppet</h1>
        </section>
        <section>
          <h1 class="blue">Język Puppet</h1>
          <p>Język Puppet zapisywany jest w manifestach</p>
          <p class="fragment">Manifesty są grupowane w moduły</p>
          <p class="fragment">Manifesty mogą zawierać definicje, klasy lub wywołania zasobów</p>
        </section>
        <section>
          <h1 class="blue">Zasób Puppet</h1>
          <p>Zasobem jest każdy pojedynczy <strong class="blue">deklaratywny</strong> element, który puppet może wymusić</p>
          <pre><code class="puppet">service { 'apache2':
  ensure => 'running',
}</code></pre>
          <p class="fragment">Puppet posiada wiele wbudowanych zasobów</p>
        </section>
        <section>
          <h2>Podstawowe zasoby</h2>
          <ul>
            <li class="fragment">file</li>
            <li class="fragment">service</li>
            <li class="fragment">package</li>
            <li class="fragment">exec</li>
            <li class="fragment">user</li>
            <li class="fragment">group</li>
            <li class="fragment">augeas</li>
          </ul>
        </section>
        <section>
          <h2>file</h2>
          <p>
            Potrafi zarządzać plikami, katalogami i linkami symbolicznymi. Dodatkowo kopiować pliki i katalogi.
          </p>
          <pre><code class="puppet">file { '/etc':
  ensure => 'directory',
  mode   => '0755',
}
file { '/etc/acme-motd':
  ensure  => 'file',
  content => 'Hello from Acme Datacenter managed by Puppet!',
  mode    => '0644',
}
file { '/etc/motd':
  ensure => 'link',
  target => '/etc/acme-motd',
}</code></pre>
        </section>
        <section>
          <h2>package</h2>
          <p>
            Potrafi zarządzać pakietami przy użyciu YUM, APT, GEM, PIP i wielu innych.
          </p>
          <pre><code class="puppet">package { 'ruby':
  ensure   => 'installed',
}
package { 'lolcat':
  ensure   => 'installed',
  provider => 'gem',
}</code></pre>
        </section>
        <section>
          <h2>service</h2>
          <p>
            Potrafi zarządzać usługami w systemie.
          </p>
          <pre><code class="puppet">service { 'apache':
  ensure     => 'running',
  enable     => true,
  hasrestart => true,
  hasstatus  => true,
}</code></pre>
        </section>
        <section>
          <h2>user</h2>
          <p>
            Zarządza użytkownikami w systemie
          </p>
          <pre><code class="puppet">user { 'ksuszynski':
  ensure => 'present',
  shell  => '/bin/bash',
  groups => ['admin', 'user'],
}</code></pre>
        </section>
        <section>
          <h2>exec</h2>
          <p>
            Pozwala na uruchamianie poleceń w systemie
          </p>
          <pre><code class="puppet">exec { '/usr/bin/yes yes | bundle exec rake gitlab:setup':
  unless      => '/usr/bin/test -f /opt/gitlab/.db_done',
  timeout     => 600,
  environment => ['RAILS_ENV=production'],
}
</code></pre>
        </section>
      </section>
      <section>

        <section>
          <h1>Kolejność</h1>
          <p>Zasoby tworzą graf w którym określamy kolejność wykonania</p>
          <pre><code class="puppet">service { 'apache2':
  ensure  => 'running',
  require => Package['apache2'],
}
package { 'apache2':
  ensure => 'installed',
}</code></pre>
          <p class="fragment">require, before, subscribe, notify</p>
        </section>
        <section>
          <h2>Polecany flow</h2>
          <code>install -> configure ~> service</code>
          <pre><code class="puppet">package { 'openssh-server':
  ensure => 'installed',
}
file { '/etc/ssh/sshd_config.conf':
  ensure  => 'file',
  content => template('myssh/sshd_config.conf.erb'),
  require => Package['openssh-server'],
}
service { 'ssh':
  ensure    => 'installed',
  subscribe => File['/etc/ssh/sshd_config.conf'],
}</code></pre>
        </section>
        <section data-background-color="#A61C00">
          <h1>Zadanie 8</h1>
          <ul>
            <li>Napisz prosty manifest instalujący i uruchamiający jedną z usług: apache, nginx, postgres, mysql</li>
            <li>Sprawdz manifest przy użyciu: <code>puppet parser validate plik.pp</code></li>
            <li>Uruchom przy użyciu Vagrant</li>
            <li>Wykorzystaj typy package, service, file i user</li>
            <li>Pamiętaj o ustawieniu kolejności</li>
            <li>Zatrzymaj usługę "ręcznie": <code>service ... stop</code> i uruchom Puppet ponownie</li>
            <li>Wywołaj w trybie debug</li>
          </ul>
        </section>
      </section>

      <section>
        <section>
          <h2>Zmienne</h2>
          <p>W języku DSL Puppet występuje możliwość tworzenia i wykorzystywania zmiennych</p>
          <p>Wbrew nazwie, raz ustalonej zmiennej nie można zmienić</p>
          <pre><code class="puppet">$service = 'apache2'
service { $service:
  ensure  => 'running',
  require => Package[$service],
}
package { $service:
  ensure => 'installed',
}
</code></pre>
          <p>
            Fakty są dostępne w przestrzeni globalnej np.: <code>$::fqdn</code>
          </p>
        </section>
        <section>
          <h2>Wyrażenia warunkowe</h2>
          <p>W języku DSL Puppet występuje zestaw wyrażeń warunkowych</p>
          <pre><code class="puppet">if $::osfamily == 'Debian' {
  $service = 'apache2'
} else {
  $service = 'httpd'
}</code></pre>
        </section>
        <section>
          <h2>Warunki case</h2>
          <pre><code class="puppet">case $::operatingsystem {
  'RedHat', 'CentOS': { $service = 'httpd' }
  /^(Debian|Ubuntu)$/:{ $service = 'apache2' }
  default:            { fail("Unsupported platform: ${::operatingsystem}") }
}</code></pre>
        </section>
        <section>
          <h2>Selektory</h2>
          <pre><code class="puppet">$rootgroup = $::osfamily ? {
  'Solaris'          => 'wheel',
  /(Darwin|FreeBSD)/ => 'wheel',
  default            => 'root',
}

file { '/etc/passwd':
  ensure => 'file',
  owner  => 'root',
  group  => $rootgroup,
}</code></pre>
        </section>

        <section>
          <h2>Funkcje</h2>
          <pre><code class="puppet">if str2bool($::is_virtual) {
  fail('unsupported')
} else {
  include ntp
}</code></pre>
<p>
  W tym przykładzie funkcje to <code>fail</code>, <code>include</code> oraz <code>str2bool</code>.
</p>
        </section>

        <section data-background-color="#A61C00">
          <h1>Zadanie 9</h1>
          <ul>
            <li>Do obsługi usługi z zadania 8 dodaj warunkową obsługę dla rodzin systemów Debian i Red Hat</li>
            <li>Sprawdź manifest przy użyciu: <code>puppet parser validate plik.pp</code></li>
            <li>Uruchom przy użyciu Vagrant</li>
            <li>Pamiętaj o ustawieniu kolejności</li>
          </ul>
        </section>
      </section>

      <section>
        <section>
          <h1 class="blue">Sposoby uruchamiania</h1>
          <h4>resource</h4>
          <h4 class="fragment">apply</h4>
          <h4 class="fragment">agent</h4>
        </section>

        <section>
          <h1>Tryb agent</h1>
          <p class="fragment">Puppet łączy się do serwera i pobiera z niego konfigurację</p>
          <p class="fragment">Dostęp tylko po SSL z zaufanym certyfikatem</p>
          <p class="fragment">Kompilacja na serwerze, wykonanie na agencie</p>
        </section>
        <section>
          <h1>Tryb agent</h1>
          <h2 class="blue">demo</h2>
        </section>

        <section data-background-color="#A61C00">
          <h1>Zadanie 10</h1>
          <ul>
            <li>Używając Vagranta uruchomić 2 maszyny master i agent</li>
            <li>Zainstalować na obu puppet</li>
            <li>Połączyć agenta do mastera</li>
            <li>Ma masterze dodać kod i przydzielić go dla agenta</li>
            <li>Uruchomić agenta</li>
          </ul>
        </section>
      </section>

      <section>
        <section>
          <h1>Wstęp do testowania</h1>
        </section>
        <section>
          <h2>Sposoby testowania</h2>
          <p>Puppet posiada szereg możliwości testowania</p>
          <ul>
            <li><code>puppet parser validate</code> i puppet-lint</li>
            <li>smoke testy i tryb bezoperacyjny</li>
            <li>rspec-puppet</li>
            <li>beaker</li>
          </ul>
          <p>
            Nie będziemu tu mówić o 2 ostatnich
          </p>
        </section>
        <section>
          <h2>Walidacja poprawności manifestów</h2>
          <ul>
            <li>IDE - polecam w szczególności na początku Geppetto, ale też Atom czy Intellij</li>
            <li>puppet-lint</li>
            <li>puppet parser validate</li>
          </ul>
        </section>
        <section>
          <h2>Tryb bezoperacyjny</h2>
          <p>
            Unikalna funkcjonalność puppet
          </p>
          <p>
            Pozwala uruchamianie manifestów bez wprowadzania zmian
          </p>
          <p>
            Flaga: <code>--noop</code>
          </p>
        </section>
        <section>
          <h2>Smoke testy Puppet</h2>
          <p>W Puppet smoke testy to po prostu uruchamianie manifestów, specjalnie przygotowanych w katalogu <code>tests</code> w trybie bezoperacyjnym <code>--noop</code></p>
          <pre><code>puppet apply tests/apache.pp --noop</code></pre>
        </section>

        <section data-background-color="#A61C00">
          <h1>Zadanie 11</h1>
          <ul>
            <li>Wykorzystując kod z zadania 9 przetestować działanie trybu bezoperacyjnego</li>
            <li>Przywrócić maszynę do stanu początkowego - sahara lub vagrant destroy</li>
            <li>Uruchomić kod z flagą <code>--noop</code></li>
          </ul>
        </section>
      </section>

      <section>
        <section data-background-color="#1C4587">
          <h1>Struktura kodu Puppet</h1>
        </section>

        <section>
          <h2>Modułowość</h2>
          <p>
            Kod puppet umieszczamy w:
          </p>
          <ul>
            <li>modułach</li>
            <li>klasach</li>
            <li>definicjach</li>
          </ul>
        </section>

        <section>
          <h2>Struktura modułu</h2>
          <pre><code>mymodule          # This outermost directory’s name matches the
│                 # name of the module.
├── manifests     # Contains all of the manifests in the module.
│   └── init.pp   # Contains a class definition. This class’s
│                 # name must match the module’s name.
├── metadata.json # Contains META information about module
├── spec          # Contains spec tests for any plugins in the
│                 # lib directory.
├── templates     # Contains templates, which the module’s
│                 # manifests can use.
├── files         # Contains files to be sourced
├── tests         # Contains examples showing how to declare
│   │             # the module's classes and defined types.
│   └── init.pp
└── lib           # Contains plugins, like custom facts and
    │             # custom resource types.
    └── puppet
        ├── provider
        └── type</code></pre>
        </section>
        <section>
          <h2>Moduły 101</h2>
          <ul>
            <li>Moduły znajdują się na PM</li>
            <li>Moduły zawierają kod Puppet</li>
            <li>Moduły posiadają określony układ</li>
            <li>Moduły mogą być prosto instalowane</li>
          </ul>
          <p>
            Wiecej: <a href="http://slides.com/cardil/reusable-puppet-module-development-and-testing">http://slides.com/cardil/...</a>
          </p>
        </section>
        <section>
          <h2>Klasy</h2>
          <ul>
            <li>Klasy to nazwane bloki kodu Puppet</li>
            <li>Są definiowane w modułach do późniejszego użycia</li>
            <li>Nie są automatycznie wywoływane, muszą być dołączone do katalogu</li>
            <li>Generalnie opisują średnie i duże fragmenty funkcjonalności</li>
            <li>Nazwa może mylić z innymi językami programowania</li>
          </ul>
        </section>
        <section>
          <h2>Klasy przykład</h2>
          <pre><code class="puppet">class apache ($version = 'latest') {
  package {'httpd':
    ensure => $version, # Using the class parameter from above
    before => File['/etc/httpd.conf'],
  }
  file {'/etc/httpd.conf':
    ensure  => file,
    owner   => 'httpd',
    content => template('apache/httpd.conf.erb'), # Template from a module
  }
  service {'httpd':
    ensure    => running,
    enable    => true,
    subscribe => File['/etc/httpd.conf'],
  }
}</code></pre>
        </section>
        <section>
          <h2>Użycie klasy</h2>
          <pre><code class="puppet"># only once in catalog
# class is a resource
class { 'apache':
  version => 'latest',
}
# or simply
include apache
include apache</code></pre>
        </section>
        <section>
          <h2>Definicje</h2>
          <ul>
            <li>To bloki kodu puppet które mogą być wywołane wielokrotnie z różnymi parametrami</li>
            <li>Mogą być użyte jako proste makra dla powtarzających się operacji</li>
          </ul>
        </section>
        <section>
          <h2>Definicje - przykład</h2>
          <pre><code class="puppet"># /etc/puppet/modules/apache/manifests/vhost.pp
define apache::vhost ($port, $docroot, $servername = $title, $vhost_name = '*') {
  include apache # contains Package['httpd'] and Service['httpd']
  include apache::params # contains common config settings
  $vhost_dir = $apache::params::vhost_dir
  file { "${vhost_dir}/${servername}.conf":
    content => template('apache/vhost-default.conf.erb'),
      # This template can access all of the parameters and variables from above.
    owner   => 'www',
    group   => 'www',
    mode    => '644',
    require => Package['httpd'],
    notify  => Service['httpd'],
  }
}</code></pre>
        </section>
        <section data-background-color="#A61C00">
          <h1>Zadanie 12</h1>
          <ul>
            <li>Wykorzystując kod z zadania 11 utworzyć moduł puppet i przenieść kod do klas i definicji</li>
            <li>Przygotować smoke testy w <code>tests</code></li>
            <li>Uruchomić testy z flagą <code>--noop</code></li>
            <li>Uruchomić kod klas</li>
          </ul>
        </section>
      </section>

      <section>
        <section>
          <h1>Kompilacja, katalog i raportowanie</h1>
        </section>
        <section>
          <h2>Kompilacja</h2>
          <ul>
            <li>Puppet kompiluje kod wczytując klasy przypisane do węzła</li>
            <li class="fragment">Sprawdzana jest kolejność i unikalność zasobów</li>
            <li class="fragment">Powstaje katalog, plik json z konkretnymi zadaniami do wykonania w określonej kolejności</li>
          </ul>
        </section>
        <section>
          <h2>Katalog</h2>
          <ul>
            <li>Katalog to wynik kompilacji</li>
            <li class="fragment">Zawiera tylko te zasoby które mają się wywołać na danym węźle</li>
            <li class="fragment">Zawiera konkretne wartości w tym treści plików i potrzebne hasła</li>
          </ul>
        </section>
        <section>
          <h2>Raport</h2>
          <ul>
            <li>W trakcie uruchomienia generowany jest raport</li>
            <li class="fragment">Raport może zostać zapisany lub wysłany do procesowa raportów</li>
            <li class="fragment">Procesory raportów to Enterprise console i Herald</li>
          </ul>
        </section>
        <section>
          <h2>PE Console</h2>
          <p><img src="img/pe-3-console.png" /></p>
        </section>
        <section>
          <h2>Herald</h2>
          <p><img style="height: 550px" src="//raw.githubusercontent.com/wavesoftware/gem-puppet-herald/gh-pages/images/reports.png" /></p>
        </section>
        <section>
          <h1>Raporty</h1>
          <h2 class="blue">demo</h2>
        </section>
      </section>

      <section data-background-color="#A61C00">
        <h1>Zadanie 13</h1>
        <ul>
          <li>Wykorzystując poznane umiejętności napisz moduł puppeta instalujący i konfigurujący blog WordPress</li>
          <li>Instalacja interpretera PHP, serwera bazy danych, serwera www, konfiguracja użytkowników systemowych</li>
          <li>Nie zapomnij o testach dymnych</li>
          <li>Postaraj się zachować idempotencję</li>
          <li>Uruchom kod i przetestuj</li>
        </ul>
      </section>

      <section>
        <h1 class="blue">Dziękuję</h1>
        <h3>Do zobaczenia</h3>
      </section>

        <!-- SLIDES ENDS HERE -->

      </div>
    </div>
    <script src="lib/js/head.min.js"></script>
    <script src="js/reveal.js"></script>
    <script>

      // Full list of configuration options available at:
      // https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
        controls: true,
        progress: true,
        history: true,
        center: true,
        zoomKey: 'ctrl',
        previewLinks: true,

        transition: 'convex', // none/fade/slide/convex/concave/zoom

        // Optional reveal.js plugins
        dependencies: [
          { src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
          { src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
          { src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
          { src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
          { src: 'plugin/zoom-js/zoom.js', async: true },
          { src: 'plugin/notes/notes.js', async: true }
        ]
      });

    </script>

  </body>
</html>
